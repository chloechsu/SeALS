<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tensor_examples</title>
  <meta name="keywords" content="tensor_examples">
  <meta name="description" content="Tensor examples playground">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html test -->
<h1>tensor_examples
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Tensor examples playground</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">Tensor examples playground
 Each %%% section is independent</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>	ALS code to perform the ALS algorithm as described in Beylkin</li><li><a href="../src/checkGridFit.html" class="code" title="function [ outputCheck ] = checkGridFit( gridT, meanT, covT, lambdaMin, lambdaMax )">checkGridFit</a>	Check if the given gaussian fits for the given grid</li><li><a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>	CP_ALS Compute a CP decomposition of any type of tensor.</li><li><a href="../src/cp_nmu.html" class="code" title="function [P,Uinit,output] = cp_nmu(X,R,opts)">cp_nmu</a>	CP_NMU Compute nonnegative CP with multiplicative updates.</li><li><a href="../src/createWeights.html" class="code" title="function [ weMean, weCov, weOnes ] = createWeights( gridT, n )">createWeights</a>	Create weights for integration</li><li><a href="../src/euler2rot.html" class="code" title="function [ R ] = euler2rot( rx, ry, rz )">euler2rot</a>	change from Euler321 to a rotation matrix (check)!!!</li><li><a href="../src/filterBasis.html" class="code" title="function [ Tout ] = filterBasis( Tin, filterIndex  )">filterBasis</a>	Retrieves the same tensor with the specified basis by filterIndex.</li><li><a href="../src/fitTensorBoundaries.html" class="code" title="function [ tensorOutput, gridTnew, dx ] = fitTensorBoundaries( tens, gridT, meanT, covT, ngridT, lambda )">fitTensorBoundaries</a>	</li><li><a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>	F - ktensor</li><li><a href="../src/interpTensor.html" class="code" title="function [ tensOutput ] = interpTensor( tens, oldgridT, newgridT )">interpTensor</a>	</li><li><a href="../src/keepSign.html" class="code" title="function [ Tcell, flipSign] = keepSign( Tcell )">keepSign</a>	keep the signs of the basis</li><li><a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>	Generate a ktensor from a diagonal gaussian pdf</li><li><a href="../src/meanCovTensor.html" class="code" title="function [ meanT, covT ] = meanCovTensor( itens, gridT, weMean, weCov, weOnes )">meanCovTensor</a>	Compute the mean and covariance of a tensor</li><li><a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>	Plots a visualization of the Tensor. For each pair of dimensions it</li><li><a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>	Plot a ktensor using different plotting styles</li><li><a href="../src/plotkTensorCell.html" class="code" title="function [ handleoutput ] = plotkTensorCell( Fcell, gridT, seqVector, varargin )">plotkTensorCell</a>	Plot a sequence of ktensors</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%Tensor examples playground</span>
0002 <span class="comment">% Each %%% section is independent</span>
0003 
0004 
0005 <span class="comment">%% %%% Create a ktensor with M terms in n dimensions</span>
0006 clear all
0007 <span class="comment">% common variables</span>
0008 dim = 3;
0009 n = [101 121 131];
0010 bdim = [0 10
0011         0 10
0012         0 10];
0013 <span class="keyword">for</span> i=1:dim
0014     dx(i) = (bdim(i,2)-bdim(i,1))/(n(i)-1); <span class="comment">% grid space</span>
0015     gridT{i} =  (bdim(i,1):dx(i):bdim(i,2))'; <span class="comment">% grid vector</span>
0016 <span class="keyword">end</span>
0017 [ weMean, weCov, weOnes ] = <a href="../src/createWeights.html" class="code" title="function [ weMean, weCov, weOnes ] = createWeights( gridT, n )">createWeights</a>( gridT, n );
0018 
0019 
0020 x0 = [2 2 2]';
0021 diagSigma = [0.3 0.2 0.2];
0022 p0 = <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( x0, diagSigma, gridT );
0023 [ meanT, covT ] = <a href="../src/meanCovTensor.html" class="code" title="function [ meanT, covT ] = meanCovTensor( itens, gridT, weMean, weCov, weOnes )">meanCovTensor</a>( p0, gridT, weMean, weCov, weOnes )
0024 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>( p0, x0, gridT, [],<span class="string">'pcolor'</span>);
0025 
0026 x1 = [8 7 8]';
0027 diagSigma1 = [0.3 0.1 0.2];
0028 p1 = <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( x1, diagSigma1, gridT );
0029 [ meanT, covT ] = <a href="../src/meanCovTensor.html" class="code" title="function [ meanT, covT ] = meanCovTensor( itens, gridT, weMean, weCov, weOnes )">meanCovTensor</a>( p1, gridT, weMean, weCov, weOnes )
0030 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>( p1, x1, gridT, [],<span class="string">'pcolor'</span>);
0031 
0032 pplus = p0+p1+<a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( [5 3 5 ], [0.5 0.1 0.2], gridT );
0033 [ meanT, covT ] = <a href="../src/meanCovTensor.html" class="code" title="function [ meanT, covT ] = meanCovTensor( itens, gridT, weMean, weCov, weOnes )">meanCovTensor</a>( pplus, gridT, weMean, weCov, weOnes )
0034 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>( pplus, meanT, gridT, [],<span class="string">'pcolor'</span>);
0035 
0036 pplus1 = arrange(pplus*(1/<a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>(pplus, [], gridT, weOnes)));
0037 [ meanT, covT ] = <a href="../src/meanCovTensor.html" class="code" title="function [ meanT, covT ] = meanCovTensor( itens, gridT, weMean, weCov, weOnes )">meanCovTensor</a>( pplus1, gridT, weMean, weCov, weOnes )
0038 
0039 
0040 
0041 figure
0042 title(<span class="string">'Marginalized fibers for each dimension'</span>)
0043 Uu = cell(dim,1);
0044 <span class="keyword">for</span> i=1:dim
0045     subplot(dim,1,i)
0046     Uu{i} = sum( repmat(pplus1.lambda',size(pplus1.U{i},1),1).*pplus1.U{i},2);  
0047     plot(gridT{i},Uu{i}) 
0048     grid on
0049     xlabel([<span class="string">'x_'</span>,num2str(i)])
0050     ylabel([<span class="string">'U_'</span>,num2str(i)])   
0051 <span class="keyword">end</span>
0052 pplus3 = ktensor(Uu);
0053 
0054 <span class="comment">%</span>
0055 afigure
0056 <span class="keyword">for</span> i=1:dim
0057     subplot(dim,1,i)
0058     tempT = <a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>(pplus1, [1:i-1 i+1:dim], gridT, weOnes);
0059     tempTT = zeros(length(gridT{1}),1);
0060     <span class="keyword">for</span> k=1:length(pplus1.lambda)
0061         tempTT = tempTT +pplus1.lambda(k)*tempT{i}(:,k);
0062     <span class="keyword">end</span>
0063     plot(gridT{i},tempTT)
0064 <span class="keyword">end</span>
0065 
0066 
0067 figure
0068 <span class="keyword">for</span> i=1:dim    
0069     <span class="keyword">for</span> j=(i+1):dim
0070         subplot(dim,dim,dim*(i-1)+j);
0071         tempT = <a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>(pplus1, [1:i-1 i+1:j-1 j+1:dim], gridT, weOnes);
0072         handleOutput = pcolor(gridT{i},gridT{j},double(ktensor(tempT.lambda,tempT.U{i},tempT.U{j}))');
0073         <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(handleOutput,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>);
0074     <span class="keyword">end</span>
0075 <span class="keyword">end</span>
0076 
0077 <span class="comment">%% %%% boundary test</span>
0078 
0079 <span class="comment">% Generate initial ktensor</span>
0080 meanT = [1 1 5 ]';
0081 covT = diag([0.5 0.1 0.2]);
0082 pcheck = <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( meanT, diag(covT), gridT );
0083 <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pcheck,gridT)
0084 
0085 <span class="comment">% Check boundary</span>
0086 lambdaMin = 4;
0087 lambdaInitial = 6;
0088 lambdaMax = 10;
0089 <a href="../src/checkGridFit.html" class="code" title="function [ outputCheck ] = checkGridFit( gridT, meanT, covT, lambdaMin, lambdaMax )">checkGridFit</a>(gridT, meanT, covT,lambdaMin,lambdaMax)
0090 
0091 [ pcheckAfter, gridT_after, dx] = <a href="../src/fitTensorBoundaries.html" class="code" title="function [ tensorOutput, gridTnew, dx ] = fitTensorBoundaries( tens, gridT, meanT, covT, ngridT, lambda )">fitTensorBoundaries</a>( pcheck, gridT, meanT, covT, n, lambdaInitial );
0092 <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pcheckAfter,gridT_after)
0093 
0094 
0095 afigure
0096 gridT = -6:0.2:6;
0097 hold on
0098 plot(gridT,normpdf(gridT,0,1))
0099 plot(gridT,normpdf(gridT,0,6/4))
0100 plot(gridT,normpdf(gridT,0,6/12),<span class="string">'.-'</span>)
0101 legend(<span class="string">'Original \lambda=6'</span>,<span class="string">'Too Big \lambda=4'</span>,<span class="string">'Too Small \lambda=12'</span>)
0102 
0103 
0104 <span class="comment">%% %%% plotfibers test</span>
0105 
0106 <span class="comment">% Show how the plotkTensorCell function works with 3 dimensions</span>
0107 clear all
0108 dim = 3;
0109 n = [101 121 131];
0110 bdim = [0 10
0111         0 10
0112         0 10];
0113 <span class="keyword">for</span> i=1:dim
0114     dx(i) = (bdim(i,2)-bdim(i,1))/(n(i)-1); <span class="comment">% grid space</span>
0115     gridT{i} =  (bdim(i,1):dx(i):bdim(i,2))'; <span class="comment">% grid vector</span>
0116 <span class="keyword">end</span>
0117 
0118 meanT = [1 1 5 ]';
0119 covT = diag([0.5 0.1 0.2]);
0120 
0121 t = 0:0.01:1;
0122 pcheck = cell(length(t),1);
0123 <span class="keyword">for</span> k=1:length(t)
0124     pcheck{k} = (2+t(k))*<a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( meanT+[t(k)*5,4*t(k)^2,sin(t(k)*2*pi)], (0.5+t(k))*diag(covT), gridT ) <span class="keyword">...</span><span class="comment"> </span>
0125          +      <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( meanT+[4,7,5]'-[t(k)*5,3*t(k)^2,sin(t(k)*2*pi)], diag(covT), gridT );
0126     pcheck{k} = arrange(pcheck{k});
0127 <span class="keyword">end</span>
0128 <a href="../src/plotkTensorCell.html" class="code" title="function [ handleoutput ] = plotkTensorCell( Fcell, gridT, seqVector, varargin )">plotkTensorCell</a>(pcheck,gridT,t,<span class="string">'plotSeq'</span>,<span class="string">'marginalizedFiber'</span>)
0129 <a href="../src/plotkTensorCell.html" class="code" title="function [ handleoutput ] = plotkTensorCell( Fcell, gridT, seqVector, varargin )">plotkTensorCell</a>(pcheck,gridT,t,<span class="string">'plotSeq'</span>,<span class="string">'slider'</span>)
0130 
0131 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0132 <span class="comment">%% %%% Test als2 for diagonal gaussians</span>
0133 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0134 
0135 <span class="comment">% Common setup</span>
0136 clear all
0137 dim = 2;
0138 n = [101 111];
0139 bdim = [-4 4
0140         -4 4];
0141     
0142 <span class="keyword">for</span> i=1:dim
0143     dx(i) = (bdim(i,2)-bdim(i,1))/(n(i)-1); <span class="comment">% grid space</span>
0144     gridT{i} =  (bdim(i,1):dx(i):bdim(i,2))'; <span class="comment">% grid vector</span>
0145 <span class="keyword">end</span>
0146 meanT = [0 0]';
0147 
0148 <span class="comment">%% Default Gaussian</span>
0149 covT = diag([1 0.5^2]);
0150 pcheck = <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( meanT , diag(covT), gridT );
0151 <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pcheck,gridT)
0152 <span class="comment">%% Test Angle</span>
0153 covT = diag([1 (1/2)^2]);
0154 [X1,X2] = meshgrid(gridT{1}',gridT{2}');
0155 theta = 0.1:0.01:pi/2*0.9;
0156 nLambda = zeros(length(theta),1);
0157 allLambda = cell(length(theta),1);
0158 pk = cell(length(theta),1);
0159 <span class="keyword">for</span> i=1:length(theta)
0160     Rtheta = [cos(theta(i)) -sin(theta(i));sin(theta(i)) cos(theta(i))];
0161     Ptheta = Rtheta*covT*Rtheta';
0162     pxy(i) = Ptheta(1,2);
0163     gaussianXY = mvnpdf([X1(:) X2(:)],meanT',Ptheta);
0164     gaussianXY = reshape(gaussianXY,length(gridT{2}),length(gridT{1}))';
0165     [pKxy1,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(gaussianXY),101,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0166     [pk{i}, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy1,1e-11,2000,[],1,0);
0167     fittemp = fit((1:length(pKxy2.lambda))',log(pKxy2.lambda),<span class="string">'poly1'</span>);
0168     fitp(i,1:2) = [fittemp.p1,fittemp.p2];
0169     pk{i} = pKxy2;
0170     <span class="comment">%pk{i} = fixMarginalSign( pk{i} );</span>
0171     <span class="comment">%plotkTensor(pKxy2,gridT);</span>
0172     allLambda{i} = pKxy2.lambda;
0173     nLambda(i) = length(pKxy2.lambda);
0174 <span class="keyword">end</span>
0175 afigure
0176 plot(theta*180/pi,nLambda)
0177 xlabel(<span class="string">'Rotation Angle'</span>)
0178 ylabel(<span class="string">'Number of terms'</span>)
0179 grid on
0180 hold on
0181 
0182 <span class="comment">% to visualize them as a set</span>
0183 figure
0184 <a href="../src/plotkTensorCell.html" class="code" title="function [ handleoutput ] = plotkTensorCell( Fcell, gridT, seqVector, varargin )">plotkTensorCell</a>(pk,gridT,theta)
0185 
0186 
0187 <span class="comment">%% check lambda plot</span>
0188 figure
0189 <span class="keyword">for</span> i=1:length(theta)
0190     hold on
0191     plot(1:length(allLambda{i}),log(allLambda{i}))
0192 <span class="keyword">end</span>
0193 
0194 
0195 
0196 <span class="comment">%% check U1 as universal gains</span>
0197 pkUnique = pk45;
0198 <span class="keyword">for</span> i=1:(length(theta))
0199     gridTn = gridT;
0200     gridTn{1} = gridT{1}*(1-0.5*sin(theta(i)));
0201     pkUnique{i} = arrange(pk2{i});
0202     pkUnique{i} = <a href="../src/interpTensor.html" class="code" title="function [ tensOutput ] = interpTensor( tens, oldgridT, newgridT )">interpTensor</a>(pkUnique{i},gridT,gridTn);
0203     pkUnique{i} = arrange(pkUnique{i});
0204 <span class="keyword">end</span>
0205 
0206 figure
0207 <a href="../src/plotkTensorCell.html" class="code" title="function [ handleoutput ] = plotkTensorCell( Fcell, gridT, seqVector, varargin )">plotkTensorCell</a>(pkUnique,gridT,theta)
0208 
0209 figure
0210 hold on
0211 <span class="keyword">for</span> i=1:(length(theta)-1)
0212     <span class="keyword">for</span> j=1:min([length(pkUnique{i}.lambda)-6,5])
0213         subplot(5,1,j)
0214         hold on
0215         plot(gridT{1},pkUnique{i}.U{1}(:,j))
0216     <span class="keyword">end</span>
0217 <span class="keyword">end</span>
0218 
0219 <span class="comment">%% check the fix marginal sign function</span>
0220 
0221 <span class="keyword">for</span> i=1:length(theta)
0222     nLambda(i) = ncomponents(pk{i});
0223 <span class="keyword">end</span>
0224 [pk2,flipSign] = <a href="../src/keepSign.html" class="code" title="function [ Tcell, flipSign] = keepSign( Tcell )">keepSign</a>(pk);
0225 
0226 <span class="comment">% plot the number of changes</span>
0227 afigure
0228 plot(theta,flipSign/2,theta,nLambda)
0229 xlabel(<span class="string">'theta'</span>)
0230 legend(<span class="string">'Number of flip pairs'</span>,<span class="string">'Number of basis functions'</span>)
0231 
0232 <span class="comment">%%</span>
0233 clear all
0234 <span class="comment">% decompose exp(-k*x*y)</span>
0235 clear all
0236 dim = 3;
0237 n = [101 121];
0238 bdim = [0 10
0239         0 10];
0240 <span class="keyword">for</span> i=1:dim
0241     dx(i) = (bdim(i,2)-bdim(i,1))/(n(i)-1); <span class="comment">% grid space</span>
0242     gridT{i} =  (bdim(i,1):dx(i):bdim(i,2))'; <span class="comment">% grid vector</span>
0243 <span class="keyword">end</span>
0244 
0245 k = 0.1;
0246 gaussianXY = zeros(n(1),n(2));
0247 <span class="keyword">for</span> i =1:n(1)
0248     <span class="keyword">for</span> j=1:n(2)
0249         gaussianXY(i,j) = exp(-k*gridT{1}(i)*gridT{2}(j));
0250     <span class="keyword">end</span>
0251 <span class="keyword">end</span>
0252 surf(gridT{1},gridT{2},gaussianXY')
0253 pKxy = [];
0254 [pKxy,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(gaussianXY),101,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0255 [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy,1e-11,2000,[],1,1);
0256 fittemp = fit((1:length(pKxy2.lambda))',log(pKxy2.lambda),<span class="string">'poly1'</span>);
0257 
0258 
0259 <span class="comment">%% Just for the 45deg case, show one case</span>
0260 thetaI = pi/4;
0261 Rtheta = [cos(thetaI) -sin(thetaI);sin(thetaI) cos(thetaI)];
0262 gaussianXY = mvnpdf([X1(:) X2(:)],meanT',Rtheta*covT*Rtheta');
0263 gaussianXY = reshape(gaussianXY,length(gridT{2}),length(gridT{1}))';
0264 [pKxy,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(gaussianXY),101,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0265 [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy,1e-8,5000,[],1,1);
0266 <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pKxy2,gridT);
0267 pk45 = pKxy2;
0268 
0269 <span class="comment">%% check error for non-negative</span>
0270 rankV = 1:20;
0271 <span class="keyword">for</span> i=rankV
0272    [Pals,~,out]= <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(pKxy,i);<span class="comment">%,'init','nvecs');</span>
0273    errals(i) = out.err(out.iters);
0274    [Pout,~,out]= <a href="../src/cp_nmu.html" class="code" title="function [P,Uinit,output] = cp_nmu(X,R,opts)">cp_nmu</a>(pKxy,i); 
0275    errnmu(i) = out.err(out.iters);
0276 <span class="keyword">end</span>
0277 afigure
0278 semilogy(rankV,errals,rankV,errnmu)
0279 xlabel(<span class="string">'Rank'</span>)
0280 ylabel(<span class="string">'Relative Error'</span>)
0281 legend(<span class="string">'ALS'</span>,<span class="string">'Non-negative CP-MU'</span>)
0282 
0283 <span class="comment">%% Check accuracy graph</span>
0284 epsV = logspace(-7,-1,200);
0285 nLambda = zeros(length(epsV),1);
0286 <span class="keyword">for</span> i=1:length(epsV)
0287     [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy,epsV(i));
0288     nLambda(i) = length(pKxy2.lambda);
0289 <span class="keyword">end</span>
0290 <span class="comment">%afigure</span>
0291 semilogx(epsV,nLambda)
0292 xlabel(<span class="string">'Required Accuracy'</span>)
0293 ylabel(<span class="string">'Number of terms'</span>)
0294 hold on
0295 grid on
0296 fitOut = fit(log10(epsV'),nLambda,<span class="string">'poly1'</span>)
0297 
0298 
0299 <span class="comment">%% Check covariance ratio</span>
0300 thetaI = pi/4;
0301 Rtheta = [cos(thetaI) -sin(thetaI);sin(thetaI) cos(thetaI)];
0302 rV = 0.1:0.001:1;
0303 <span class="comment">%rV = [2 4 8 16];</span>
0304 <span class="comment">%rV = 1./rV;</span>
0305 nLambda = zeros(length(rV),1);
0306 <span class="keyword">for</span> i = 1:length(rV)
0307     covT = diag([1 rV(i)^2]);
0308     gaussianXY = mvnpdf([X1(:) X2(:)],meanT',Rtheta*covT*Rtheta');
0309     gaussianXY = reshape(gaussianXY,length(gridT{2}),length(gridT{1}));
0310     [pKxy,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(gaussianXY),101,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0311     [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy);
0312     nLambda(i) = length(pKxy2.lambda);
0313 <span class="keyword">end</span>
0314 afigure
0315 plot(rV,nLambda)
0316 xlabel(<span class="string">'Covariance Ratio'</span>)
0317 ylabel(<span class="string">'Number of terms'</span>)
0318 grid on
0319 
0320 
0321 <span class="comment">%% Check locus test</span>
0322 nLambda = zeros(100,1);
0323 figure
0324 hold on
0325 <span class="keyword">for</span> i=1:length(nLambda)
0326     [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy,1e-8);
0327     nLambda(i) = length(pKxy2.lambda);
0328     <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pKxy2,gridT);
0329 <span class="keyword">end</span>
0330 xlabel(<span class="string">'Number of terms'</span>)
0331 grid on
0332 
0333 nLambda = length(pKxy2.lambda);
0334 
0335 <span class="keyword">for</span> i=1:nLambda
0336     figure(i)
0337     filterVector = zeros(nLambda,1);
0338     filterVector(i) = 1;
0339     <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(<a href="../src/filterBasis.html" class="code" title="function [ Tout ] = filterBasis( Tin, filterIndex  )">filterBasis</a>(pKxy2,filterVector),gridT);
0340     
0341 <span class="keyword">end</span>
0342 
0343 
0344 <span class="comment">%% 3D gaussian</span>
0345 
0346 <span class="comment">% Common setup</span>
0347 clear all
0348 dim = 3;
0349 n = [101 101 101];
0350 bdim = [-4 4 
0351         -4 4
0352         -4 4];
0353     
0354 <span class="keyword">for</span> i=1:dim
0355     dx(i) = (bdim(i,2)-bdim(i,1))/(n(i)-1); <span class="comment">% grid space</span>
0356     gridT{i} =  (bdim(i,1):dx(i):bdim(i,2))'; <span class="comment">% grid vector</span>
0357 <span class="keyword">end</span>
0358 meanT = [0 0 0]';
0359 
0360 <span class="comment">%% Default Gaussian</span>
0361 covT = diag([1 0.5^2 0.25^2]);
0362 pcheck = <a href="../src/ktensorGaussian.html" class="code" title="function [ ktens ] = ktensorGaussian( xMean, diagCov, gridT )">ktensorGaussian</a>( meanT , diag(covT), gridT );
0363 <a href="../src/plotkTensor.html" class="code" title="function [ handleOutput ] = plotkTensor( F, gridT, varargin )">plotkTensor</a>(pcheck,gridT)
0364 <span class="comment">%% Test Angle</span>
0365 [X1,X2,X3] = meshgrid(gridT{1}',gridT{2}',gridT{3}');
0366 omega = 0:0.1:pi/2;
0367 phi = 0:0.1:pi/2;
0368 nLambda = zeros(length(omega),length(phi));
0369 <span class="keyword">for</span> i=1:length(omega)
0370     <span class="keyword">for</span> j=1:length(phi)
0371         Rtheta = <a href="../src/euler2rot.html" class="code" title="function [ R ] = euler2rot( rx, ry, rz )">euler2rot</a>( omega(i), phi(j), 0 );
0372         <span class="comment">%Rtheta = [cos(theta(i)) -sin(theta(i));sin(theta(i)) cos(theta(i))];</span>
0373         gaussianXY = mvnpdf([X1(:) X2(:) X2(:)],meanT',Rtheta*covT*Rtheta');
0374         gaussianXY = reshape(gaussianXY,length(gridT{2}),length(gridT{1}),length(gridT{3}));
0375         [pKxy,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(gaussianXY),101,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0376         [pKxy2, err, iter, e_list, t_step, illcond, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(pKxy);
0377         <span class="comment">%pk{i} = pKxy2;</span>
0378         <span class="comment">%plotkTensor(pKxy2,gridT);</span>
0379         nLambda(i,j) = length(pKxy2.lambda);
0380     <span class="keyword">end</span>
0381 <span class="keyword">end</span>
0382 figure
0383 surf(omega*180/pi,phi*180/pi,nLambda)
0384 xlabel(<span class="string">'\Omega'</span>)
0385 ylabel(<span class="string">'\phi'</span>)
0386 zlabel(<span class="string">'Number of terms'</span>)
0387 grid on
0388 hold on
0389</pre></div>
<hr><address>Generated on Fri 12-Jan-2018 11:28:53 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_convergence_radar</title>
  <meta name="keywords" content="test_convergence_radar">
  <meta name="description" content="% Load data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html test -->
<h1>test_convergence_radar
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% Load data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Load data</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>	ALS code to perform the ALS algorithm as described in Beylkin</li><li><a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>	CP_ALS Compute a CP decomposition of any type of tensor.</li><li><a href="../src/hRadar.html" class="code" title="function [ hMes ] = hRadar( x, rpos )">hRadar</a>	measurement function for the radar at rpos in 2D</li><li><a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>	F - ktensor</li><li><a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>	Plots a visualization of the Tensor. For each pair of dimensions it</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 
0002 <span class="comment">%% Load data</span>
0003 load(<span class="string">'gridVTOL.mat'</span>)
0004 <span class="comment">%% Analyze Measurement PDFs for non-linear functions</span>
0005 
0006 
0007 
0008 <span class="comment">% Old</span>
0009 <span class="comment">%zradar = [1.04,4.6996];</span>
0010 <span class="comment">%r1 = [0,6]';</span>
0011 <span class="comment">%r2 = [2,4]';</span>
0012 r1 = [-1,5]';
0013 r2 = [3,3.5]'; 
0014 xGT = [1,5];
0015 zradar = [(xGT(1)-r1(1))^2+(xGT(2)-r1(2))^2 ;<span class="comment">%+ randn(1)*sqrt(sigmaX2)</span>
0016               (xGT(1)-r2(1))^2+(xGT(2)-r2(2))^2] ;<span class="comment">%+ randn(1)*sqrt(sigmaX2)];</span>
0017 
0018 gridXY = {gridT{1},gridT{3}}; <span class="comment">% extract only x and y grids</span>
0019 <span class="keyword">for</span> i=1:length(gridXY{1})
0020     <span class="keyword">for</span> j=1:length(gridXY{2})
0021         pzx1(i,j) = exp( -(zradar(1)-<a href="../src/hRadar.html" class="code" title="function [ hMes ] = hRadar( x, rpos )">hRadar</a>([gridXY{1}(i),0,gridXY{2}(j),0,0,0],r1))^2/sigmaX2/25/2);
0022         pzx2(i,j) = exp( -(zradar(2)-<a href="../src/hRadar.html" class="code" title="function [ hMes ] = hRadar( x, rpos )">hRadar</a>([gridXY{1}(i),0,gridXY{2}(j),0,0,0],r2))^2/sigmaX2/25/2);
0023         pzx(i,j) = pzx1(i,j)*pzx2(i,j) ;
0024         pzxPlus(i,j) = pzx1(i,j)+pzx2(i,j);
0025     <span class="keyword">end</span>
0026 <span class="keyword">end</span>
0027 
0028 <span class="comment">%% Show basis</span>
0029 figure
0030 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'fontsize'</span>,20)
0031 hold on
0032 hPcolor1 = pcolor(gridXY{1},gridXY{2},pzx1');
0033 xlabel(<span class="string">'x'</span>)
0034 ylabel(<span class="string">'y'</span>)
0035 scatter(xGT(1),xGT(2),<span class="string">'r'</span>,<span class="string">'f'</span>)
0036 scatter(r1(1),r1(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0037 colorbar
0038 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(hPcolor1, <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0039 legend(<span class="string">'PDF'</span>,<span class="string">'Target'</span>,<span class="string">'Radar'</span>)
0040 
0041 figure
0042 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'fontsize'</span>,20)
0043 hold on
0044 hPcolor2 = pcolor(gridXY{1},gridXY{2},pzx2');
0045 xlabel(<span class="string">'x'</span>)
0046 ylabel(<span class="string">'y'</span>)
0047 scatter(xGT(1),xGT(2),<span class="string">'r'</span>,<span class="string">'f'</span>)
0048 scatter(r2(1),r2(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0049 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(hPcolor2, <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0050 legend(<span class="string">'PDF'</span>,<span class="string">'Target'</span>,<span class="string">'Radar'</span>)
0051 
0052 figure
0053 hold on
0054 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'fontsize'</span>,20)
0055 hPcolorPlus = pcolor(gridXY{1},gridXY{2},pzxPlus');
0056 xlabel(<span class="string">'x'</span>)
0057 ylabel(<span class="string">'y'</span>)
0058 scatter(xGT(1),xGT(2),<span class="string">'r'</span>,<span class="string">'f'</span>)
0059 scatter(r1(1),r1(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0060 scatter(r2(1),r2(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0061 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(hPcolorPlus, <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0062 legend(<span class="string">'PDF'</span>,<span class="string">'Target'</span>,<span class="string">'Radar'</span>)
0063 
0064 figure
0065 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'fontsize'</span>,20)
0066 hold on
0067 hPcolorboth = pcolor(gridXY{1},gridXY{2},pzx');
0068 xlabel(<span class="string">'x'</span>)
0069 ylabel(<span class="string">'y'</span>)
0070 scatter(xGT(1),xGT(2),<span class="string">'r'</span>)
0071 scatter(r1(1),r1(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0072 scatter(r2(1),r2(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0073 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(hPcolorboth, <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0074 legend(<span class="string">'PDF'</span>,<span class="string">'Target'</span>,<span class="string">'Radar'</span>)
0075 colorbar
0076 
0077 
0078 <span class="comment">%% Show basis functions with increasing order</span>
0079 rankV = 1:15; 
0080 err = zeros(length(rankV),1);
0081 <span class="keyword">for</span> i = 1:length(rankV)
0082     [pKxy,Uo,out(i)] = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(pzx),rankV(i),<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0083     err(i) = norm(double(pKxy)-pzx);
0084     <span class="comment">%handles = plot2DslicesAroundPoint(pKxy, [0,0], gridXY);</span>
0085     <span class="comment">%ylim(handles{1,1},[-3 3])</span>
0086     <span class="comment">%ylim(handles{2,2},[-3 3])</span>
0087     <span class="comment">%set(handles{1,1},'Color','black')</span>
0088     <span class="comment">%colormap(handles{1,1},'gray')</span>
0089     <span class="comment">%saveas(gcf,['convergence_rank_',num2str(rankV(i)),'.png'])</span>
0090     comp(i) = (length(gridXY{1})+length(gridXY{1}))*rankV(i)/length(gridXY{1})/length(gridXY{2});
0091     <span class="comment">%clf</span>
0092 <span class="keyword">end</span>
0093 afigure
0094 plot(rankV,err)
0095 xlabel(<span class="string">'Tensor Decomposition Rank'</span>)
0096 ylabel(<span class="string">'Error Norm'</span>)
0097 
0098 afigure
0099 plot(rankV,comp)
0100 
0101 <span class="comment">%% Show the influence of random init</span>
0102 rankV = 20*ones(200,1);
0103 err = zeros(length(rankV),1);
0104 figure
0105 grid on
0106 <span class="keyword">for</span> j=1:rankV(1)
0107     hf(j,1) = subplot(2,rankV(1),j);
0108     xlabel([<span class="string">'X Basis Function '</span>,num2str(j)])
0109     ylabel(<span class="string">'Value'</span>)
0110     hold( hf(j,1),<span class="string">'on'</span>)
0111     grid( hf(j,1),<span class="string">'on'</span>)
0112     hf(j,2) = subplot(2,rankV(1),j+rankV(1));
0113     hold( hf(j,2),<span class="string">'on'</span>)
0114     ylabel(<span class="string">'Value'</span>)
0115     xlabel([<span class="string">'Y Basis Function '</span>,num2str(j)])
0116     grid( hf(j,2),<span class="string">'on'</span>)
0117 <span class="keyword">end</span>
0118 <span class="keyword">for</span> i = 1:length(rankV)
0119     pKxy = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(pzx),rankV(i));<span class="comment">%,'init','nvecs');</span>
0120     <span class="keyword">for</span> j=1:rankV(1)
0121         plot(hf(j,1),gridXY{1},pKxy.lambda(j)*pKxy.U{1}(:,j),<span class="string">'black'</span>);
0122         plot(hf(j,2),gridXY{2},pKxy.lambda(j)*pKxy.U{2}(:,j),<span class="string">'black'</span>);
0123     <span class="keyword">end</span>
0124     <span class="comment">%handles =plot2DslicesAroundPoint(pKxy, [0,0], gridXY);</span>
0125     <span class="comment">%ylim(handles{1,1},[-8 8])</span>
0126     <span class="comment">%ylim(handles{2,2},[-8 8])</span>
0127     <span class="comment">%pause(1)</span>
0128 <span class="keyword">end</span>
0129 [mean(err),mean(errNVECS)]
0130 figure
0131 hist(err)
0132 xlabel(<span class="string">'Tensor Decomposition Rank'</span>)
0133 ylabel(<span class="string">'Error Norm'</span>)
0134 
0135 
0136 <span class="comment">%% Show the extended mesurement pdf to 6D for the VTOL case</span>
0137 pKxy = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(tensor(pzx),5);
0138 dim = 6;
0139 dim_z = [1,3];
0140 Ucell = cell(dim,1);
0141 <span class="comment">%surf(gridXY{1},gridXY{2},pzx,'EdgeColor','none')</span>
0142 <span class="keyword">for</span> i=1:dim
0143     <span class="keyword">if</span> all(i ~= dim_z)
0144         Ucell{i} = ones(length(gridT{i}),5);
0145     <span class="keyword">else</span>
0146         
0147         Ucell{i} = pKxy.U{find(dim_z==i)};
0148     <span class="keyword">end</span>
0149 <span class="keyword">end</span>
0150 pKxyFull = ktensor(pKxy.lambda,Ucell);
0151 <span class="keyword">for</span> i=1:dim
0152     expec(i)  = <a href="../src/intTens.html" class="code" title="function [Fint] = intTens(F, dim, gridT, w)">intTens</a>(pKxyFull, [], gridT, we(i,:));
0153 <span class="keyword">end</span>
0154 
0155 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>(pKxyFull, expec, gridT);
0156 
0157 <span class="comment">%% build a sparse tensor from the points</span>
0158 k = 1;
0159 spValue = 0;
0160 spSubs = [1,0];
0161 <span class="keyword">for</span> i=1:10:length(gridXY{1})
0162     <span class="keyword">for</span> j=1:10:length(gridXY{2})
0163         pzx1(i,j) = exp( -(zradar(1)-<a href="../src/hRadar.html" class="code" title="function [ hMes ] = hRadar( x, rpos )">hRadar</a>([gridXY{1}(i),0,gridXY{2}(j),0,0,0],r1))^2/sigmaX2/25/2);
0164         pzx2(i,j) = exp( -(zradar(2)-<a href="../src/hRadar.html" class="code" title="function [ hMes ] = hRadar( x, rpos )">hRadar</a>([gridXY{1}(i),0,gridXY{2}(j),0,0,0],r2))^2/sigmaX2/25/2);
0165         pzx(i,j) = pzx1(i,j)*pzx2(i,j) ;
0166         spValue(k) = pzx(i,j);
0167         spSubs(k,:) = [i,j];
0168         k = k+1;
0169     <span class="keyword">end</span>
0170 <span class="keyword">end</span>
0171 dim = 2;
0172 <span class="comment">% Build ktensor sparse</span>
0173 <span class="keyword">for</span> i=1:dim
0174    UcellSP{i}=zeros(length(gridXY{i}),length(spValue));
0175 <span class="keyword">end</span>
0176 <span class="keyword">for</span> i=length(spValue)
0177     <span class="keyword">for</span> j=1:dim
0178         UcellSP{j}(spSubs(i,j),i)=1;
0179     <span class="keyword">end</span>
0180 <span class="keyword">end</span>
0181 sparseKtensorPzk = ktensor(spValue',UcellSP);
0182 
0183 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>(sparseKtensorPzk, [0,0], gridXY);
0184 
0185 [spPzkComp, err_op, iter_op, enrich_op, t_step_op, cond_op, noreduce] = <a href="../src/als2.html" class="code" title="function [F, err, iter, e_list, t_step, illcond, noreduce] = als2(op,varargin)">als2</a>(sparseKtensorPzk,1e-3);
0186 
0187 spPzk = sptensor(spSubs,spValue',[length(gridXY{1}) length(gridXY{2})]);
0188 
0189 kspPxk = <a href="../src/cp_als.html" class="code" title="function [P,Uinit,output] = cp_als(X,R,varargin)">cp_als</a>(full(spPzk),5,<span class="string">'init'</span>,<span class="string">'nvecs'</span>);
0190 
0191 <a href="../src/plot2DslicesAroundPoint.html" class="code" title="function [ handleOutput ] = plot2DslicesAroundPoint(Ftensor, point, gridT, handleInput, plotType)">plot2DslicesAroundPoint</a>(kspPxk, [0,0], gridXY);
0192 
0193 figure
0194 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'fontsize'</span>,20)
0195 hold on
0196 hPcolorboth = pcolor(gridXY{1},gridXY{2},double(kspPxk)');
0197 xlabel(<span class="string">'x'</span>)
0198 ylabel(<span class="string">'y'</span>)
0199 scatter(xGT(1),xGT(2),<span class="string">'r'</span>)
0200 scatter(r1(1),r1(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0201 scatter(r2(1),r2(2),<span class="string">'black'</span>,<span class="string">'f'</span>)
0202 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(hPcolorboth, <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0203 legend(<span class="string">'PDF'</span>,<span class="string">'Target'</span>,<span class="string">'Radar'</span>)
0204 colorbar</pre></div>
<hr><address>Generated on Fri 12-Jan-2018 11:28:53 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>